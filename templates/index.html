{% extends "base.html" %}
{% block content %}
<h2>Dashboard</h2>

<div class="cards">
  <div class="card">
    <h3>Income</h3>
    <p>₹{{ "%.2f"|format(income) }}</p>
  </div>
  <div class="card">
    <h3>Expense</h3>
    <p>₹{{ "%.2f"|format(expense) }}</p>
  </div>
  <div class="card">
    <h3>Balance</h3>
    <p>₹{{ "%.2f"|format(balance) }}</p>
  </div>
</div>

<section>
  <h3>Expense by Category (All time)</h3>
  <div style="width: 350px; margin: auto;">
    <canvas id="catChart"></canvas>
</div>

</section>

<section>
  <h3>Recent Transactions</h3>
  <table class="transactions">
    <thead><tr><th>Date</th><th>Type</th><th>Amount</th><th>Category</th><th>Note</th></tr></thead>
    <tbody>
    {% for t in transactions %}
      <tr>
        <td>{{ t.date }}</td>
        <td>{{ t.type }}</td>
        <td>₹{{ "%.2f"|format(t.amount) }}</td>
        <td>{{ t.category }}</td>
        <td>{{ t.note }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</section>

<script>
// load category data and render Chart.js pie
fetch("/api/category_data")
  .then(r => r.json())
  .then(data => {
    const ctx = document.getElementById('catChart').getContext('2d');
    new Chart(ctx, {
      type: 'pie',
      data: {
        labels: data.labels,
        datasets: [{
          data: data.values,
        }]
      },
      options: {
        responsive: true
      }
    });
  });
</script>
{% endblock %}
